/*! puredom.rest 03-05-2014 */
!function(a){"function"==typeof window.define&&window.define.amd?window.define(["puredom"],a):a(window.puredom)}(function(a){function b(a){return new b.Resource(a)}b.Resource=function(b){a.EventEmitter.call(this),this.url=b||this.url,this.query=a.extend({},this.query)},a.inherits(b.Resource,a.EventEmitter),a.extend(b.Resource.prototype,{url:"/",query:{},param:function(b,c){if("string"==typeof b){if(1===arguments.length)return this.query[b];this.query[b]=c}return"object"==typeof b&&a.extend(this.query,b),this},index:function(a){return this._call("GET /",null,a)},get:function(a,b){return this._call("GET /"+a,null,b)},post:function(a,b){return this._call("POST /",a,b)},put:function(a,b,c){return this._call("PUT /"+a,b,c)},del:function(a,b){return this._call("DELETE /"+a,null,b)},_call:function(b,c,d,e){var f,g,h,i=this,j="GET",k={},l=a.extend({},this.query),m=b.split(" ");e=e||{},e.headers&&a.extend(k,e.headers),e.query&&a.extend(l,e.query),m[0]===m[0].toUpperCase()&&(j=m.splice(0,1)[0]),b=m.join(" "),b="/"+b.replace(/(^\/+|\/+$)/g,""),f=b,h=a.querystring.stringify(l),h&&(b+=(b.indexOf("?")<0?"?":"&")+h),g=b,b=this.url.replace(/(?:^([a-z]+\:\/\/)|(\/)\/+|\/+$)/g,"$1$2")+b,"POST"===j?c=a.querystring.stringify(c):c&&(k["content-type"]="application/json",c=a.json.stringify(c));var n={path:f,querystring:h,query:l,url:g,fullUrl:b,method:j,headers:k,body:c};return this.fireEvent("req",n),this.fireEvent("req:"+g,n),a.net.request({url:b,method:j,headers:k,body:c,callback:function(){var b,c,e,f={status:this.status,data:this.responseText+"",headers:{}},h=this.request.getAllResponseHeaders(),j=/^([a-z\-]+)\s*\:/gim;for(j.lastIndex=0;b=j.exec(h);)f.headers[b[1].toLowerCase()]=this.request.getResponseHeader(b[1]);for("json"===this.request.responseType?f.json=this.request.response:f.data.match(/^(\{[\s\S]+\}|\[[\s\S]+\]|\"[\s\S]+\")$/)&&(f.json=a.json.parse(f.data)),f.error=f.status>=400?f.json||f.data:null,f.response=f.status<400?f.json||f.data:null,c=["status","status:"+f.status,"res","res:"+g],e=0;e<c.length;e++)i.fireEvent(c[e],[n,f]);d.call(i,f.error,f.response,f)}}),this}});try{b.Resource.prototype["delete"]=b.Resource.prototype.del}catch(c){}return a.rest=b.rest=b,b});