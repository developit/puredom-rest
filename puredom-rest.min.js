/*! puredom-rest 1.1.4 */
!function(a,b){"function"==typeof define&&define.amd?define(["puredom"],b):"object"==typeof module&&module.exports?module.exports=b(require("puredom")):window.puredom.rest=b(window.puredom)}(this,function(a){function b(a){return new b.Resource(a)}b.Resource=function(b){a.EventEmitter.call(this),this.url=b||this.url,this.query=a.extend({},this.query),this.headers=a.extend({},this.headers)},a.inherits(b.Resource,a.EventEmitter);var c=b.Resource.prototype;a.extend(c,{url:"/",query:{},headers:{},param:function(b,c){if("string"==typeof b){if(1===arguments.length)return this.query[b];this.query[b]=c}return"object"==typeof b&&a.extend(this.query,b),this},header:function(a,b){var c;if("string"==typeof a){if(1===arguments.length)return this.headers[key];this.headers[a.toLowerCase()]=b}if("object"==typeof a)for(c in a)a.hasOwnProperty(c)&&this.header(c,a[c]);return this},index:function(a,b){return this._call("GET /",null,a,b)},get:function(a,b,c){return this._call("GET /"+a,null,b,c)},post:function(a,b,c){return this._call("POST /",a,b,c)},put:function(a,b,c,d){return a&&"object"==typeof a&&"function"==typeof b&&(c=b,b=a,a=b[this.idKey]),this._call("PUT /"+a,b,c,d)},del:function(a,b,c){return this._call("DELETE /"+a,null,b,c)},idKey:"id",serializeBody:function(b,c){return"POST"===c.method?a.querystring.stringify(b):b?(c.headers["content-type"]||(c.headers["content-type"]="application/json"),a.json.stringify(b)):void 0},_call:function(b,c,d,e){var f,g,h,i=this,j="GET",k=a.extend({},this.headers),l=a.extend({},this.query),m=b.split(" ");e=e||{},e.headers&&a.forEach(e.headers,function(a,b){k[b.toLowerCase()]=a}),e.query&&a.extend(l,e.query),m[0]===m[0].toUpperCase()&&(j=m.splice(0,1)[0]),b=m.join(" "),b=("/"+b.replace(/(^\/+|\/+$)/g,"")).replace(/\/+$/g,""),f=b,h=a.querystring.stringify(l),h&&(b+=(b.indexOf("?")<0?"?":"&")+h),g=b,b=this.url.replace(/(?:^([a-z]+\:\/\/)|(\/)\/+|\/+$)/g,"$1$2")+b;var n={path:f,querystring:h,query:l,url:b,fullUrl:b,relativeUrl:g,method:j,headers:k,body:c,rawBody:c};return e.responseType&&(n.responseType=e.responseType),"function"==typeof this.serializeBody&&(n.body=this.serializeBody(c,n)||n.body),this.fireEvent("req",n),this.fireEvent("req:"+g,n),a.net.request(n,function(){var b,c,e,f,h={status:this.status,data:this.response,headers:{}},j=this.request.getAllResponseHeaders(),k=/^([a-z\-]+)\s*\:/gim,l=i.errorMessageProp||i.messageProp,m=!h.status||h.status>=400;for(k.lastIndex=0;b=k.exec(j);)h.headers[b[1].toLowerCase()]=this.request.getResponseHeader(b[1]);for("json"===this.request.responseType?h.json=this.request.response:"string"==typeof h.data&&h.data.match(/^(?:\s|\n)*(\{[\s\S]*\}|\[[\s\S]*\]|\"[\s\S]*\")(?:\s|\n)*$/)?h.json=a.json.parse(h.data):this.request.responseType&&(h[this.request.responseType]=this.request.response),h.error=m?h.json||h.data||"Error "+h.status:null,h.response=m?null:h.json||h.data,f=h.error?"error":"success",h.error&&l&&(h.error=a.delve(h.error,l,!1,!0)||h.error),c=["status","status:"+h.status,"res","res:"+g,f,f+":"+g],e=0;e<c.length;e++)i.fireEvent(c[e],[n,h]);"function"==typeof d&&d.call(i,h.error,h.response,h)}),this}}),c.create=c.post,c.read=c.get,c.update=c.put,c.remove=c.del;try{c["delete"]=c.del}catch(d){}return a.rest=b.rest=b,b});