/*! puredom-rest 1.0.0 */
!function(a){"function"==typeof window.define&&window.define.amd?window.define(["puredom"],a):a(window.puredom)}(function(a){function b(a){return new b.Resource(a)}b.Resource=function(b){a.EventEmitter.call(this),this.url=b||this.url,this.query=a.extend({},this.query)},a.inherits(b.Resource,a.EventEmitter);var c=b.Resource.prototype;a.extend(c,{url:"/",query:{},param:function(b,c){if("string"==typeof b){if(1===arguments.length)return this.query[b];this.query[b]=c}return"object"==typeof b&&a.extend(this.query,b),this},index:function(a){return this._call("GET /",null,a)},get:function(a,b){return this._call("GET /"+a,null,b)},post:function(a,b){return this._call("POST /",a,b)},put:function(a,b,c){return a&&"object"==typeof a&&"function"==typeof b&&(c=b,b=a,a=b[this.idKey]),this._call("PUT /"+a,b,c)},del:function(a,b){return this._call("DELETE /"+a,null,b)},idKey:"id",serializeBody:function(b,c){return"POST"===c.method?a.querystring.stringify(b):b?(c.headers["content-type"]||(c.headers["content-type"]="application/json"),a.json.stringify(b)):void 0},_call:function(b,c,d,e){var f,g,h,i=this,j="GET",k={},l=a.extend({},this.query),m=b.split(" ");e=e||{},e.headers&&a.extend(k,e.headers),e.query&&a.extend(l,e.query),m[0]===m[0].toUpperCase()&&(j=m.splice(0,1)[0]),b=m.join(" "),b="/"+b.replace(/(^\/+|\/+$)/g,""),f=b,h=a.querystring.stringify(l),h&&(b+=(b.indexOf("?")<0?"?":"&")+h),g=b,b=this.url.replace(/(?:^([a-z]+\:\/\/)|(\/)\/+|\/+$)/g,"$1$2")+b;var n={path:f,querystring:h,query:l,url:b,fullUrl:b,relativeUrl:g,method:j,headers:k,body:c,rawBody:c};return"function"==typeof this.serializeBody&&(n.body=this.serializeBody(c,n)||n.body),this.fireEvent("req",n),this.fireEvent("req:"+g,n),a.net.request(n,function(){var b,c,e,f,h={status:this.status,data:this.responseText+"",headers:{}},j=this.request.getAllResponseHeaders(),k=/^([a-z\-]+)\s*\:/gim,l=i.errorMessageProp||i.messageProp;for(k.lastIndex=0;b=k.exec(j);)h.headers[b[1].toLowerCase()]=this.request.getResponseHeader(b[1]);for("json"===this.request.responseType?h.json=this.request.response:h.data.match(/^(\{[\s\S]+\}|\[[\s\S]+\]|\"[\s\S]+\")$/)&&(h.json=a.json.parse(h.data)),h.error=h.status>=400?h.json||h.data||"Error "+h.status:null,h.response=h.status<400?h.json||h.data:null,f=h.error?"error":"success",h.error&&l&&(h.error=a.delve(h.error,l,!1,!0)||h.error),c=["status","status:"+h.status,"res","res:"+g,f,f+":"+g],e=0;e<c.length;e++)i.fireEvent(c[e],[n,h]);"function"==typeof d&&d.call(i,h.error,h.response,h)}),this}}),c.create=c.post,c.read=c.get,c.update=c.put,c.remove=c.del;try{c["delete"]=c.del}catch(d){}return a.rest=b.rest=b,b});